<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear Cuenta | Mi Aplicación</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .message-placeholder {
            min-height: 24px;
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-start min-h-screen py-12">

    <div class="w-full max-w-md p-8 space-y-4 bg-white rounded-xl shadow-lg">
        <!-- Encabezado -->
        <div class="text-center">
            <h1 class="text-3xl font-bold text-gray-900">Crear una Cuenta</h1>
            <p class="mt-2 text-sm text-gray-600">
                Elige tu método preferido para registrarte.
            </p>
        </div>

        <!-- Botón de Google -->
        <div>
             <button id="google-signin-btn" class="w-full flex items-center justify-center py-2.5 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200">
                <svg class="w-5 h-5 mr-3" viewBox="0 0 48 48">
                    <path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path><path fill="#FF3D00" d="M6.306,14.691l6.06-4.893C14.641,5.696,19.083,4,24,4c5.186,0,9.956,1.967,13.694,5.657l-5.657,5.657C30.046,13.12,27.21,12,24,12c-3.059,0-5.842,1.154-7.961,3.039L6.306,14.691z"></path><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.06,4.893C8.951,39.602,15.981,44,24,44z"></path><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571l6.19,5.238C41.382,34.464,44,29.69,44,24C44,22.659,43.862,21.35,43.611,20.083z"></path>
                </svg>
                Continuar con Google
            </button>
        </div>

        <!-- Separador "O" -->
        <div class="flex items-center">
            <div class="flex-grow border-t border-gray-300"></div>
            <span class="mx-4 text-sm font-medium text-gray-500">O</span>
            <div class="flex-grow border-t border-gray-300"></div>
        </div>

        <!-- Formulario de Email/Contraseña -->
        <form id="signup-form" class="space-y-4" novalidate>
            <div>
                <label for="email" class="sr-only">Correo Electrónico</label>
                <input id="email" name="email" type="email" required class="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" placeholder="Correo Electrónico">
            </div>
            <div>
                <label for="password" class="sr-only">Contraseña</label>
                <input id="password" name="password" type="password" required class="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" placeholder="Contraseña (mín. 6 caracteres)">
            </div>
            <div>
                <label for="confirm-password" class="sr-only">Confirmar Contraseña</label>
                <input id="confirm-password" name="confirm-password" type="password" required class="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" placeholder="Confirmar Contraseña">
            </div>
            <div>
                <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200">
                    Crear Cuenta con Email
                </button>
            </div>
        </form>

        <!-- Contenedor para mensajes -->
        <div id="message-container" class="message-placeholder text-center text-sm"></div>

        <!-- Enlace a Iniciar Sesión -->
        <p class="text-center text-sm text-gray-600">
            ¿Ya tienes una cuenta?
            <a href="login.html" class="font-medium text-blue-600 hover:text-blue-500">
                Inicia sesión aquí
            </a>
        </p>
    </div>

    <!-- SDKs de Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD4FopYX645rwDYGSQTdDV0VObqds6q34g",
            authDomain: "proyecto-barack-4f731.firebaseapp.com",
            projectId: "proyecto-barack-4f731",
            storageBucket: "proyecto-barack-4f731.appspot.com",
            messagingSenderId: "730750717116",
            appId: "1:730750717116:web:1fbcab2cbb59e0d83454b9"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const googleProvider = new GoogleAuthProvider();

        // =================================================================================
        // REFERENCIAS AL DOM
        // =================================================================================
        const signupForm = document.getElementById('signup-form');
        const googleBtn = document.getElementById('google-signin-btn');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const confirmPasswordInput = document.getElementById('confirm-password');
        const messageContainer = document.getElementById('message-container');

        // =================================================================================
        // FUNCIÓN DE REDIRECCIÓN
        // =================================================================================
        const redirectToHome = () => {
            window.location.href = 'home.html';
        };
        
        // =================================================================================
        // MANEJADOR DE ERRORES Y ÉXITO
        // =================================================================================
        const handleAuthSuccess = (userCredential) => {
            console.log('Autenticación exitosa:', userCredential.user.uid);
            messageContainer.textContent = '¡Éxito! Redirigiendo...';
            messageContainer.className = 'message-placeholder text-center text-sm text-green-600';
            setTimeout(redirectToHome, 1500);
        };

        const handleAuthError = (error) => {
            console.error("Error de autenticación:", error.code, error.message);
            let friendlyMessage = 'Ocurrió un error inesperado.';
            switch (error.code) {
                case 'auth/email-already-in-use':
                    friendlyMessage = 'Este correo electrónico ya está registrado.';
                    break;
                case 'auth/invalid-email':
                    friendlyMessage = 'El formato del correo electrónico no es válido.';
                    break;
                case 'auth/weak-password':
                    friendlyMessage = 'La contraseña es muy débil (mínimo 6 caracteres).';
                    break;
                case 'auth/account-exists-with-different-credential':
                    friendlyMessage = 'Ya existe una cuenta con este email. Intenta iniciar sesión con el método que usaste originalmente.';
                    break;
                case 'auth/popup-closed-by-user':
                    friendlyMessage = 'La ventana de inicio de sesión fue cerrada.';
                    break;
                default:
                    friendlyMessage = 'Error al intentar iniciar sesión. Por favor, inténtalo de nuevo.';
            }
            messageContainer.textContent = friendlyMessage;
            messageContainer.className = 'message-placeholder text-center text-sm text-red-600';
        };

        // =================================================================================
        // EVENT LISTENERS
        // =================================================================================

        // --- Inicio de sesión con Google ---
        googleBtn.addEventListener('click', () => {
            messageContainer.textContent = '';
            signInWithPopup(auth, googleProvider)
                .then(handleAuthSuccess)
                .catch(handleAuthError);
        });
        
        // --- Registro con Email y Contraseña ---
        signupForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = emailInput.value;
            const password = passwordInput.value;
            const confirmPassword = confirmPasswordInput.value;

            // Limpiar mensajes anteriores
            messageContainer.textContent = ''; 

            if (password !== confirmPassword) {
                handleAuthError({ code: 'custom/password-mismatch', message: 'Las contraseñas no coinciden.' });
                messageContainer.textContent = 'Las contraseñas no coinciden.';
                return;
            }

            createUserWithEmailAndPassword(auth, email, password)
                .then(handleAuthSuccess)
                .catch(handleAuthError);
        });
    </script>
</body>
</html>
